{"ast":null,"code":"import _asyncToGenerator from \"F:/statvalu/project/AR_DocuExpert_Test/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { FlatTreeControl } from '@angular/cdk/tree';\nimport { BehaviorSubject, merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { DirectoryService } from 'src/app/featuremodules/input-folder/services/directory.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/auth/auth.service\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"src/app/_helpers/common/commonn.service\";\n/** Flat node with expandable and level information */\n\nexport class DynamicFlatNode {\n  constructor(item, level = 1, expandable = false, count, isLoading = false) {\n    this.item = item;\n    this.level = level;\n    this.expandable = expandable;\n    this.count = count;\n    this.isLoading = isLoading;\n  }\n\n} // injactable \n\nexport class DynamicDatabase {\n  constructor(_auth, http, _common) {\n    this._auth = _auth;\n    this.http = http;\n    this._common = _common;\n    this.dataMap = new Map([]);\n    this.count = 0;\n    this.rootLevelNodes = [];\n\n    this._common.$foldersTreeData.subscribe(res => {\n      this.rootLevelNodes = [res];\n      console.log(\"??????????????????????????????????????????\", this.rootLevelNodes);\n    });\n  }\n\n  getChildNodeData(path) {\n    let formData = new FormData();\n    formData.append(\"user_id\", this._auth.user_id);\n    formData.append(\"dir_path\", path);\n    return this.http.post('/filestorage_features/recursiontree/', formData);\n  }\n\n  initialChild() {\n    this._common.$foldersTreeData.subscribe(res => {\n      this.rootLevelNodes = [res];\n    });\n  } // rootLevelNodes: object[] = [{\n  //   \"name\": this._auth.user_name,\n  //   \"id\": 0,\n  //   \"path\":'Output_Folder/' + this._auth.org_name + '/' + this._auth.user_name,\n  //   \"type\": \"directory\",\n  //   \"expanded\": false,\n  // }];\n\n  /** Initial data from database */\n\n\n  initialData() {\n    // this.initialChild()\n    return this.rootLevelNodes.map(item => new DynamicFlatNode([item], 0, true, this.count));\n  }\n\n  getNodeChildrenData(node) {\n    return new Promise((resolve, reject) => {\n      console.log(\"in new data get section\");\n      this.getChildNodeData(node[0].path).subscribe(res => {\n        console.log(\"child response\", res.res_data.jsonData.children);\n        this.dataMap.set(node[0].path, res.res_data.jsonData.children);\n        resolve(this.dataMap);\n      });\n    });\n  }\n\n  getChildren(node) {\n    console.log(\"*****\", node, node[0].name, this.dataMap.get(node[0].path));\n    return this.dataMap.get(node[0].path);\n  }\n\n  isExpandable(node) {\n    console.log(\">>>>>>>\", node);\n    console.log(\">>>>>>>\", node, this.dataMap.has(node.path));\n    return this.dataMap.has(node.path);\n  }\n\n}\n\nDynamicDatabase.ɵfac = function DynamicDatabase_Factory(t) {\n  return new (t || DynamicDatabase)(i0.ɵɵinject(i1.AuthService), i0.ɵɵinject(i2.HttpClient), i0.ɵɵinject(i3.CommonnService));\n};\n\nDynamicDatabase.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: DynamicDatabase,\n  factory: DynamicDatabase.ɵfac,\n  providedIn: 'root'\n}); ///////\n\nexport class DynamicDataSource {\n  constructor(_treeControl, _database) {\n    this._treeControl = _treeControl;\n    this._database = _database;\n    this.dataChange = new BehaviorSubject([]);\n  }\n\n  get data() {\n    return this.dataChange.value;\n  }\n\n  set data(value) {\n    this._treeControl.dataNodes = value;\n    this.dataChange.next(value);\n  }\n\n  connect(collectionViewer) {\n    this._treeControl.expansionModel.changed.subscribe(change => {\n      if (change.added || change.removed) {\n        this.handleTreeControl(change);\n      }\n    });\n\n    return merge(collectionViewer.viewChange, this.dataChange).pipe(map(() => this.data));\n  }\n\n  disconnect(collectionViewer) {}\n  /** Handle expand/collapse behaviors */\n\n\n  handleTreeControl(change) {\n    if (change.added) {\n      change.added.forEach(node => this.toggleNode(node, true));\n    }\n\n    if (change.removed) {\n      change.removed.slice().reverse().forEach(node => this.toggleNode(node, false));\n    }\n  }\n  /**\r\n   * Toggle the node, remove from display list\r\n   */\n\n\n  toggleNode(node, expand) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      node.isLoading = true;\n      console.log(\"start here .......>>>>\", node, node.item[0], expand);\n      const result = yield _this._database.getNodeChildrenData(node.item);\n      console.log(\"promise result is ....\", result);\n      const children = yield _this._database.getChildren(node.item);\n      console.log('childrens are', children);\n      console.log('data is', _this.data);\n\n      const index = _this.data.indexOf(node);\n\n      console.log('index is', index, !children || index < 0);\n\n      if (!children || index < 0) {\n        // If no children, or cannot find the node, no op\n        return;\n      }\n\n      setTimeout(() => {\n        if (expand) {\n          const nodes = children.map(name => new DynamicFlatNode([name], node.level + 1, _this._database.isExpandable(name), children.length));\n\n          _this.data.splice(index + 1, 0, ...nodes);\n        } else {\n          let count = 0;\n\n          for (let i = index + 1; i < _this.data.length && _this.data[i].level > node.level; i++, count++) {}\n\n          _this.data.splice(index + 1, count);\n        } // notify the change\n\n\n        _this.dataChange.next(_this.data);\n\n        node.isLoading = false;\n      }, 1000);\n    })();\n  }\n\n}\nlet TreeviewComponent = // export class TreeviewComponent implements OnInit {\n//   constructor() { }\n// }\nclass TreeviewComponent {\n  constructor(database, _common, _directory, route) {\n    this.database = database;\n    this._common = _common;\n    this._directory = _directory;\n    this.route = route;\n\n    this.getLevel = node => node.level;\n\n    this.isExpandable = node => node.expandable;\n\n    this.hasChild = (_, _nodeData) => _nodeData.expandable;\n\n    route.queryParams.subscribe(p => console.log(\"router event\", p.myQueryParam));\n    this.treeControl = new FlatTreeControl(this.getLevel, this.isExpandable);\n    this.dataSource = new DynamicDataSource(this.treeControl, database);\n    this.dataSource.data = database.initialData();\n    console.log(\"initial data\", this.dataSource.data);\n  }\n\n  ngOnInit() {\n    console.log(\"ngoninit called\");\n  }\n\n  selectedNode(val) {\n    console.log(\"selectedNode is\", val.item[0].path);\n    console.log(\"addd val\", this.database.dataMap);\n    this.redirectUserToDir(val.item[0].path);\n\n    this._directory.getChildNodeData(val.item[0].path).subscribe(res => {\n      console.log(\"child response\", res.res_data.jsonData.children);\n\n      if (res.res_data.jsonData.children.length > 0) {\n        this.database.dataMap.set(val.item[0].path, res.res_data.jsonData.children);\n      }\n    }); // this.database.dataMap.set(\"Output_Folder/ORG@STS/shubham21/BibleData\", [\n    //   {\n    //     \"name\": \"02_Certified Non-Incident Statement_2021.06.12 (002)_output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/02_Certified Non-Incident Statement_2021.06.12 (002)_output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   },\n    //   {\n    //     \"name\": \"00___086_output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/00___086_output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   },\n    //   {\n    //     \"name\": \"1. Current Time In Service 13-May-2019_output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/1. Current Time In Service 13-May-2019_output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   },\n    //   {\n    //     \"name\": \"output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   }\n    // ])\n\n\n    console.log(\"addd val\", this.database.dataMap);\n  }\n\n  redirectUserToDir(path) {\n    console.log(\"in redirect user to dir>>>>>>>>>>>>>\", path);\n    path = path + '/';\n\n    if (path.includes('Input')) {\n      this._common.redirectToNestedFolder(path, 'input');\n    } else if (path.includes('Req')) {\n      this._common.redirectToNestedFolder(path, 'req');\n    } else if (path.includes('Err_Info')) {\n      this._common.redirectToNestedFolder(path, 'err');\n    } else if (path.includes('Output')) {\n      this._common.redirectToNestedFolder(path, 'output');\n    }\n  }\n\n};\nTreeviewComponent = __decorate([Component({\n  selector: 'app-treeview',\n  templateUrl: './treeview.component.html',\n  styleUrls: ['./treeview.component.scss'],\n  providers: [DirectoryService],\n  styles: []\n}) // export class TreeviewComponent implements OnInit {\n//   constructor() { }\n// }\n], TreeviewComponent);\nexport { TreeviewComponent };","map":{"version":3,"sources":["F:\\statvalu\\project\\AR_DocuExpert_Test\\src\\app\\shared\\treeview\\treeview.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnInit, Injectable } from '@angular/core';\nimport {\n  CollectionViewer,\n  SelectionChange,\n  DataSource,\n} from '@angular/cdk/collections';\nimport { FlatTreeControl } from '@angular/cdk/tree';\nimport { BehaviorSubject, merge, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { CommonnService } from 'src/app/_helpers/common/commonn.service';\nimport { DirectoryService } from 'src/app/featuremodules/input-folder/services/directory.service';\nimport { AuthService } from 'src/app/auth/auth.service';\nimport { HttpClient } from '@angular/common/http';\nimport { Router,ActivatedRoute } from '@angular/router';\n\n\n\n\n/** Flat node with expandable and level information */\nexport class DynamicFlatNode {\n  constructor(\n    public item: object[],\n    public level = 1,\n    public expandable = false,\n    public count:Number,\n    public isLoading = false\n  ) { }\n}\n\n// injactable \n@Injectable({ providedIn: 'root',})\nexport class DynamicDatabase {\n  constructor(private _auth: AuthService,private http:HttpClient,private _common:CommonnService){\n    this._common.$foldersTreeData.subscribe((res:any) => {\n      this.rootLevelNodes = [res];\n      console.log(\"??????????????????????????????????????????\",this.rootLevelNodes)\n    });\n  }\n  dataMap = new Map<string, object[]>([]);\n  count:Number=0\n\n  rootLevelNodes: object[] = [];\n\n  \n\n  getChildNodeData(path:string){\n    let formData = new FormData;\n    formData.append(\"user_id\", this._auth.user_id);\n    formData.append(\"dir_path\", path);\n\n    return this.http.post('/filestorage_features/recursiontree/', formData);\n  }\n  \n  initialChild(){\n    this._common.$foldersTreeData.subscribe((res:any) => {\n      this.rootLevelNodes = [res];\n    });\n  }\n\n  // rootLevelNodes: object[] = [{\n  //   \"name\": this._auth.user_name,\n  //   \"id\": 0,\n  //   \"path\":'Output_Folder/' + this._auth.org_name + '/' + this._auth.user_name,\n  //   \"type\": \"directory\",\n  //   \"expanded\": false,\n  // }];\n\n  /** Initial data from database */\n  initialData(): DynamicFlatNode[] {\n    // this.initialChild()\n    return this.rootLevelNodes.map(\n      (item) => new DynamicFlatNode([item], 0, true,this.count)\n    );\n  }\n\n   getNodeChildrenData(node:any){\n    return new Promise((resolve, reject) => {\n      console.log(\"in new data get section\")\n      this.getChildNodeData(node[0].path).subscribe((res: any) => {\n          console.log(\"child response\",res.res_data.jsonData.children)\n          this.dataMap.set(node[0].path,res.res_data.jsonData.children)\n          resolve(this.dataMap)\n        });\n    })\n    \n    }\n\n   getChildren(node: any) {\n    console.log(\"*****\", node, node[0].name, this.dataMap.get(node[0].path))\n    return this.dataMap.get(node[0].path);\n  }\n\n  isExpandable(node: any): boolean {\n    console.log(\">>>>>>>\", node)\n    console.log(\">>>>>>>\", node, this.dataMap.has(node.path))\n    return this.dataMap.has(node.path);\n  }\n}\n\n///////\nexport class DynamicDataSource implements DataSource<DynamicFlatNode> {\n  dataChange = new BehaviorSubject<DynamicFlatNode[]>([]);\n\n  get data(): DynamicFlatNode[] {\n    return this.dataChange.value;\n  }\n  set data(value: DynamicFlatNode[]) {\n    this._treeControl.dataNodes = value;\n    this.dataChange.next(value);\n  }\n\n  constructor(\n    private _treeControl: FlatTreeControl<DynamicFlatNode>,\n    private _database: DynamicDatabase\n  ) { }\n\n  connect(collectionViewer: CollectionViewer): Observable<DynamicFlatNode[]> {\n    this._treeControl.expansionModel.changed.subscribe((change) => {\n      if (\n        (change as SelectionChange<DynamicFlatNode>).added ||\n        (change as SelectionChange<DynamicFlatNode>).removed\n      ) {\n        this.handleTreeControl(change as SelectionChange<DynamicFlatNode>);\n      }\n    });\n\n    return merge(collectionViewer.viewChange, this.dataChange).pipe(\n      map(() => this.data)\n    );\n  }\n\n  disconnect(collectionViewer: CollectionViewer): void { }\n\n  /** Handle expand/collapse behaviors */\n  handleTreeControl(change: SelectionChange<DynamicFlatNode>) {\n    if (change.added) {\n      change.added.forEach((node) => this.toggleNode(node, true));\n    }\n    if (change.removed) {\n      change.removed\n        .slice()\n        .reverse()\n        .forEach((node) => this.toggleNode(node, false));\n    }\n  }\n\n  /**\n   * Toggle the node, remove from display list\n   */\n  async toggleNode(node: DynamicFlatNode, expand: boolean) {\n    node.isLoading = true;\n    console.log(\"start here .......>>>>\",node,node.item[0],expand)\n   const result= await this._database.getNodeChildrenData(node.item)\n   console.log(\"promise result is ....\",result)\n    const children =await this._database.getChildren(node.item);\n    console.log('childrens are', children);\n    console.log('data is', this.data);\n    const index = this.data.indexOf(node);\n    console.log('index is', index, (!children || index < 0));\n    if (!children || index < 0) {\n      // If no children, or cannot find the node, no op\n      return;\n    }\n\n\n    setTimeout(() => {\n      if (expand) {\n        const nodes = children.map(\n          (name) =>\n            new DynamicFlatNode(\n              [name],\n              node.level + 1,\n              this._database.isExpandable(name),\n              children.length\n            )\n        );\n        this.data.splice(index + 1, 0, ...nodes);\n      } else {\n        let count = 0;\n        for (\n          let i = index + 1;\n          i < this.data.length && this.data[i].level > node.level;\n          i++, count++\n        ) { }\n        this.data.splice(index + 1, count);\n      }\n\n      // notify the change\n      this.dataChange.next(this.data);\n      node.isLoading = false;\n    }, 1000);\n  }\n \n}\n\n\n\n@Component({\n  selector: 'app-treeview',\n  templateUrl: './treeview.component.html',\n  styleUrls: ['./treeview.component.scss'],\n  providers: [DirectoryService]\n\n})\n// export class TreeviewComponent implements OnInit {\n\n//   constructor() { }\n\n  \n\n// }\nexport class TreeviewComponent implements OnInit{\n  constructor(private database: DynamicDatabase,private _common: CommonnService,private _directory: DirectoryService,private route: ActivatedRoute) {\n    \n      route.queryParams.subscribe(p => console.log(\"router event\",p.myQueryParam));\n    this.treeControl = new FlatTreeControl<DynamicFlatNode>(\n      this.getLevel,\n      this.isExpandable\n    );\n    this.dataSource = new DynamicDataSource(this.treeControl, database);\n\n    this.dataSource.data = database.initialData();\n    console.log(\"initial data\", this.dataSource.data)\n  }\n\n  ngOnInit(): void {\n    console.log(\"ngoninit called\")\n  }\n\n  //   ngOnInit(): void {\n  //    this.dataSource.data = await this.database.initialData();\n\n  // }\n\n  treeControl: FlatTreeControl<DynamicFlatNode>;\n\n  dataSource: DynamicDataSource;\n\n  getLevel = (node: DynamicFlatNode) => node.level;\n\n  isExpandable = (node: DynamicFlatNode) => node.expandable;\n\n  hasChild = (_: number, _nodeData: DynamicFlatNode) => _nodeData.expandable;\n\n  selectedNode(val: any) {\n    console.log(\"selectedNode is\", val.item[0].path)\n    console.log(\"addd val\", this.database.dataMap)\n   this.redirectUserToDir(val.item[0].path)\n\n    this._directory.getChildNodeData(val.item[0].path).subscribe((res: any) => {\n  console.log(\"child response\",res.res_data.jsonData.children)\n  if(res.res_data.jsonData.children.length>0){\n  this.database.dataMap.set(val.item[0].path,res.res_data.jsonData.children)\n  }\n});\n\n    // this.database.dataMap.set(\"Output_Folder/ORG@STS/shubham21/BibleData\", [\n    //   {\n    //     \"name\": \"02_Certified Non-Incident Statement_2021.06.12 (002)_output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/02_Certified Non-Incident Statement_2021.06.12 (002)_output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   },\n    //   {\n    //     \"name\": \"00___086_output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/00___086_output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   },\n    //   {\n    //     \"name\": \"1. Current Time In Service 13-May-2019_output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/1. Current Time In Service 13-May-2019_output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   },\n    //   {\n    //     \"name\": \"output\",\n    //     \"id\": 1,\n    //     \"path\": \"Output_Folder/ORG@STS/shubham21/BibleData/output\",\n    //     \"type\": \"directory\",\n    //     \"expanded\": false,\n    //     \"children\": []\n    //   }\n    // ])\n\n    console.log(\"addd val\", this.database.dataMap)\n  }\n\n  redirectUserToDir(path: string) {\n    console.log(\"in redirect user to dir>>>>>>>>>>>>>\",path)\n    path = path + '/'\n    if (path.includes('Input')) {\n      this._common.redirectToNestedFolder(path, 'input');\n    } else if (path.includes('Req')) {\n      this._common.redirectToNestedFolder(path, 'req');\n    } else if (path.includes('Err_Info')) {\n      this._common.redirectToNestedFolder(path, 'err');\n    } else if (path.includes('Output')) {\n      this._common.redirectToNestedFolder(path, 'output');\n    }\n  }\n\n}"],"sourceRoot":""},"metadata":{},"sourceType":"module"}