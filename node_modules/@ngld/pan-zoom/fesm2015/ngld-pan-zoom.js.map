{"version":3,"file":"ngld-pan-zoom.js","sources":["../../src/lib/pan-zoom.directive.ts","../../src/lib/pan-zoom-exclude.directive.ts","../../src/lib/pan-zoom-directive.module.ts","../../src/public-api.ts","../../src/ngld-pan-zoom.ts"],"sourcesContent":["import { Directive, ElementRef, OnInit, OnDestroy, HostListener, Output, EventEmitter, Input, Inject } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { normalizePassiveListenerOptions } from '@angular/cdk/platform';\nimport { PanZoomExcludeDirective } from './pan-zoom-exclude.directive';\n\nconst activeCapturingEventOptions = normalizePassiveListenerOptions({\n  passive: false,\n  capture: true,\n});\n\nfunction isTouch(event: MouseEvent | TouchEvent): event is TouchEvent {\n  return !!(event as TouchEvent).targetTouches;\n}\n\nfunction getCoordinate(\n  event: MouseEvent | TouchEvent,\n  clientRect: { left: number, top: number }): { x: number, y: number } {\n  if (isTouch(event)) {\n    return {\n      x: event.targetTouches[0].clientX,\n      y: event.targetTouches[1].clientY,\n    };\n  }\n  return {\n    x: event.clientX - clientRect.left,\n    y: event.clientY - clientRect.top,\n  };\n}\n\n@Directive({\n  selector: '[ngldPanZoom]'\n})\nexport class PanZoomDirective implements OnInit, OnDestroy {\n\n  private pointerOrigin = { x: 0, y: 0 };\n  private isPointerDown = false;\n  private boundingSize?: { width: number, height: number };\n  private previousViewBox ?= {\n    minX: 0, minY: 0, width: 500, height: 500,\n  };\n  private excludeChildrenElements: PanZoomExcludeDirective[] = [];\n  private document: Document;\n\n  @Input() viewBox = {\n    minX: 0, minY: 0, width: 500, height: 500,\n  };\n\n  @Input() scaleFactor = 1.3;\n\n  @Output() viewBoxChanged = new EventEmitter<{\n    minX: number, minY: number, width: number, height: number,\n  }>();\n\n  constructor(\n    private el: ElementRef<SVGSVGElement>,\n    // Avoid ngcc error:\n    // https://github.com/angular/components/blob/2b1d84e2bc1d7295e53a753211e99a0e73110b45/src/cdk/drag-drop/drag-drop-registry.ts#L64\n    @Inject(DOCUMENT) $document: any,\n  ) {\n    this.document = $document;\n  }\n\n  ngOnInit(): void {\n    this.document.addEventListener('touchstart', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.addEventListener('mousedown', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.addEventListener('pointerdown', this.pointerDownListener, activeCapturingEventOptions);\n\n    this.document.addEventListener('touchend', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.addEventListener('mouseup', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.addEventListener('pointerup', this.pointerUpListener, activeCapturingEventOptions);\n\n    this.document.addEventListener('touchmove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.addEventListener('mousemove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.addEventListener('pointermove', this.pointerMoveListener, activeCapturingEventOptions);\n  }\n\n  ngOnDestroy(): void {\n    this.document.removeEventListener('touchstart', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.removeEventListener('mousedown', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.removeEventListener('pointerdown', this.pointerDownListener, activeCapturingEventOptions);\n\n    this.document.removeEventListener('touchend', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.removeEventListener('mouseup', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.removeEventListener('pointerup', this.pointerUpListener, activeCapturingEventOptions);\n\n    this.document.removeEventListener('touchmove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.removeEventListener('mousemove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.removeEventListener('pointermove', this.pointerMoveListener, activeCapturingEventOptions);\n  }\n\n  /**\n   * excludeChild\n   */\n  public excludeChild(component: PanZoomExcludeDirective): void {\n    this.excludeChildrenElements.push(component);\n  }\n\n  /**\n   * onExcludeDestroyed\n   */\n  public onExcludeDestroyed(component: PanZoomExcludeDirective): void {\n    this.excludeChildrenElements = this.excludeChildrenElements\n      .filter(c => c !== component);\n  }\n\n  private pointerDownListener = (event: TouchEvent | MouseEvent) => {\n    if (!this.el.nativeElement.contains(event.target as HTMLElement)) {\n      return;\n    }\n    if (this.excludeChildrenElements.find(c => c.checkExclusion(event.target as HTMLElement))) {\n      this.isPointerDown = false;\n      return;\n    }\n    this.isPointerDown = true;\n    this.pointerOrigin = getCoordinate(event, { top: 0, left: 0 });\n    this.previousViewBox = { ...this.viewBox };\n    this.boundingSize = undefined;\n  }\n\n  private pointerUpListener = (event: TouchEvent | MouseEvent) => {\n    this.isPointerDown = false;\n    this.previousViewBox = undefined;\n  }\n\n  private pointerMoveListener = (event: TouchEvent | MouseEvent) => {\n    if (!this.isPointerDown) {\n      return;\n    }\n    if (!this.boundingSize) {\n      this.boundingSize = this.el.nativeElement.getBoundingClientRect();\n    }\n    // Prevent user to do a selection on the page\n    event.preventDefault();\n\n    // Get the current pointer position\n    const pointerPosition = getCoordinate(event, { top: 0, left: 0 });\n    const ratio = this.previousViewBox.width / this.boundingSize.width;\n\n    const newViewBox = {\n      minX: this.previousViewBox.minX - ((pointerPosition.x - this.pointerOrigin.x) * ratio),\n      minY: this.previousViewBox.minY - ((pointerPosition.y - this.pointerOrigin.y) * ratio)\n    };\n\n    this.viewBoxChanged.emit({ ...this.viewBox, ...newViewBox });\n  }\n\n  @HostListener('wheel', ['$event'])\n  onZoom(e: WheelEvent): void {\n    e.preventDefault();\n    const position = getCoordinate(e, this.el.nativeElement.getBoundingClientRect());\n    const scale = Math.pow(this.scaleFactor, e.deltaY < 0 ? 1 : -1);\n    const sx = position.x / this.el.nativeElement.clientWidth;\n    const sy = position.y / this.el.nativeElement.clientHeight;\n\n    const x = this.viewBox.minX + this.viewBox.width * sx;\n    const y = this.viewBox.minY + this.viewBox.height * sy;\n    this.viewBoxChanged.emit({\n      minX: x + scale * (this.viewBox.minX - x),\n      minY: y + scale * (this.viewBox.minY - y),\n      width: this.viewBox.width * scale,\n      height: this.viewBox.height * scale,\n    });\n  }\n\n}\n","import { Directive, OnInit, OnDestroy, ElementRef } from '@angular/core';\nimport { PanZoomDirective } from './pan-zoom.directive';\n\n@Directive({\n  selector: '[ngldPanZoomExclude]'\n})\nexport class PanZoomExcludeDirective implements OnInit, OnDestroy {\n\n  constructor(\n    private el: ElementRef<SVGSVGElement>,\n    private parentCanvas: PanZoomDirective,\n  ) { }\n\n  /**\n   * checkExclusion\n   */\n  public checkExclusion(target: HTMLElement): boolean {\n    return this.el.nativeElement.contains(target);\n  }\n\n  ngOnDestroy(): void {\n    this.parentCanvas.onExcludeDestroyed(this);\n  }\n\n  ngOnInit(): void {\n    this.parentCanvas.excludeChild(this);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { PanZoomDirective } from './pan-zoom.directive';\nimport { PanZoomExcludeDirective } from './pan-zoom-exclude.directive';\n\n\n\n@NgModule({\n  declarations: [PanZoomDirective, PanZoomExcludeDirective],\n  imports: [],\n  exports: [PanZoomDirective, PanZoomExcludeDirective]\n})\nexport class PanZoomDirectiveModule { }\n","/*\n * Public API Surface of pan-zoom-directive\n */\n\nexport * from './lib/pan-zoom.directive';\nexport * from './lib/pan-zoom-exclude.directive';\nexport * from './lib/pan-zoom-directive.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}