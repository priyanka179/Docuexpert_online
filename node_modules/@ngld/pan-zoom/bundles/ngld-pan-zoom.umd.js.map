{"version":3,"file":"ngld-pan-zoom.umd.js","sources":["../../src/lib/pan-zoom.directive.ts","../../src/lib/pan-zoom-exclude.directive.ts","../../src/lib/pan-zoom-directive.module.ts","../../src/public-api.ts","../../src/ngld-pan-zoom.ts"],"sourcesContent":["import { Directive, ElementRef, OnInit, OnDestroy, HostListener, Output, EventEmitter, Input, Inject } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { normalizePassiveListenerOptions } from '@angular/cdk/platform';\nimport { PanZoomExcludeDirective } from './pan-zoom-exclude.directive';\n\nconst activeCapturingEventOptions = normalizePassiveListenerOptions({\n  passive: false,\n  capture: true,\n});\n\nfunction isTouch(event: MouseEvent | TouchEvent): event is TouchEvent {\n  return !!(event as TouchEvent).targetTouches;\n}\n\nfunction getCoordinate(\n  event: MouseEvent | TouchEvent,\n  clientRect: { left: number, top: number }): { x: number, y: number } {\n  if (isTouch(event)) {\n    return {\n      x: event.targetTouches[0].clientX,\n      y: event.targetTouches[1].clientY,\n    };\n  }\n  return {\n    x: event.clientX - clientRect.left,\n    y: event.clientY - clientRect.top,\n  };\n}\n\n@Directive({\n  selector: '[ngldPanZoom]'\n})\nexport class PanZoomDirective implements OnInit, OnDestroy {\n\n  private pointerOrigin = { x: 0, y: 0 };\n  private isPointerDown = false;\n  private boundingSize?: { width: number, height: number };\n  private previousViewBox ?= {\n    minX: 0, minY: 0, width: 500, height: 500,\n  };\n  private excludeChildrenElements: PanZoomExcludeDirective[] = [];\n  private document: Document;\n\n  @Input() viewBox = {\n    minX: 0, minY: 0, width: 500, height: 500,\n  };\n\n  @Input() scaleFactor = 1.3;\n\n  @Output() viewBoxChanged = new EventEmitter<{\n    minX: number, minY: number, width: number, height: number,\n  }>();\n\n  constructor(\n    private el: ElementRef<SVGSVGElement>,\n    // Avoid ngcc error:\n    // https://github.com/angular/components/blob/2b1d84e2bc1d7295e53a753211e99a0e73110b45/src/cdk/drag-drop/drag-drop-registry.ts#L64\n    @Inject(DOCUMENT) $document: any,\n  ) {\n    this.document = $document;\n  }\n\n  ngOnInit(): void {\n    this.document.addEventListener('touchstart', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.addEventListener('mousedown', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.addEventListener('pointerdown', this.pointerDownListener, activeCapturingEventOptions);\n\n    this.document.addEventListener('touchend', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.addEventListener('mouseup', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.addEventListener('pointerup', this.pointerUpListener, activeCapturingEventOptions);\n\n    this.document.addEventListener('touchmove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.addEventListener('mousemove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.addEventListener('pointermove', this.pointerMoveListener, activeCapturingEventOptions);\n  }\n\n  ngOnDestroy(): void {\n    this.document.removeEventListener('touchstart', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.removeEventListener('mousedown', this.pointerDownListener, activeCapturingEventOptions);\n    this.document.removeEventListener('pointerdown', this.pointerDownListener, activeCapturingEventOptions);\n\n    this.document.removeEventListener('touchend', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.removeEventListener('mouseup', this.pointerUpListener, activeCapturingEventOptions);\n    this.document.removeEventListener('pointerup', this.pointerUpListener, activeCapturingEventOptions);\n\n    this.document.removeEventListener('touchmove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.removeEventListener('mousemove', this.pointerMoveListener, activeCapturingEventOptions);\n    this.document.removeEventListener('pointermove', this.pointerMoveListener, activeCapturingEventOptions);\n  }\n\n  /**\n   * excludeChild\n   */\n  public excludeChild(component: PanZoomExcludeDirective): void {\n    this.excludeChildrenElements.push(component);\n  }\n\n  /**\n   * onExcludeDestroyed\n   */\n  public onExcludeDestroyed(component: PanZoomExcludeDirective): void {\n    this.excludeChildrenElements = this.excludeChildrenElements\n      .filter(c => c !== component);\n  }\n\n  private pointerDownListener = (event: TouchEvent | MouseEvent) => {\n    if (!this.el.nativeElement.contains(event.target as HTMLElement)) {\n      return;\n    }\n    if (this.excludeChildrenElements.find(c => c.checkExclusion(event.target as HTMLElement))) {\n      this.isPointerDown = false;\n      return;\n    }\n    this.isPointerDown = true;\n    this.pointerOrigin = getCoordinate(event, { top: 0, left: 0 });\n    this.previousViewBox = { ...this.viewBox };\n    this.boundingSize = undefined;\n  }\n\n  private pointerUpListener = (event: TouchEvent | MouseEvent) => {\n    this.isPointerDown = false;\n    this.previousViewBox = undefined;\n  }\n\n  private pointerMoveListener = (event: TouchEvent | MouseEvent) => {\n    if (!this.isPointerDown) {\n      return;\n    }\n    if (!this.boundingSize) {\n      this.boundingSize = this.el.nativeElement.getBoundingClientRect();\n    }\n    // Prevent user to do a selection on the page\n    event.preventDefault();\n\n    // Get the current pointer position\n    const pointerPosition = getCoordinate(event, { top: 0, left: 0 });\n    const ratio = this.previousViewBox.width / this.boundingSize.width;\n\n    const newViewBox = {\n      minX: this.previousViewBox.minX - ((pointerPosition.x - this.pointerOrigin.x) * ratio),\n      minY: this.previousViewBox.minY - ((pointerPosition.y - this.pointerOrigin.y) * ratio)\n    };\n\n    this.viewBoxChanged.emit({ ...this.viewBox, ...newViewBox });\n  }\n\n  @HostListener('wheel', ['$event'])\n  onZoom(e: WheelEvent): void {\n    e.preventDefault();\n    const position = getCoordinate(e, this.el.nativeElement.getBoundingClientRect());\n    const scale = Math.pow(this.scaleFactor, e.deltaY < 0 ? 1 : -1);\n    const sx = position.x / this.el.nativeElement.clientWidth;\n    const sy = position.y / this.el.nativeElement.clientHeight;\n\n    const x = this.viewBox.minX + this.viewBox.width * sx;\n    const y = this.viewBox.minY + this.viewBox.height * sy;\n    this.viewBoxChanged.emit({\n      minX: x + scale * (this.viewBox.minX - x),\n      minY: y + scale * (this.viewBox.minY - y),\n      width: this.viewBox.width * scale,\n      height: this.viewBox.height * scale,\n    });\n  }\n\n}\n","import { Directive, OnInit, OnDestroy, ElementRef } from '@angular/core';\nimport { PanZoomDirective } from './pan-zoom.directive';\n\n@Directive({\n  selector: '[ngldPanZoomExclude]'\n})\nexport class PanZoomExcludeDirective implements OnInit, OnDestroy {\n\n  constructor(\n    private el: ElementRef<SVGSVGElement>,\n    private parentCanvas: PanZoomDirective,\n  ) { }\n\n  /**\n   * checkExclusion\n   */\n  public checkExclusion(target: HTMLElement): boolean {\n    return this.el.nativeElement.contains(target);\n  }\n\n  ngOnDestroy(): void {\n    this.parentCanvas.onExcludeDestroyed(this);\n  }\n\n  ngOnInit(): void {\n    this.parentCanvas.excludeChild(this);\n  }\n\n}\n","import { NgModule } from '@angular/core';\nimport { PanZoomDirective } from './pan-zoom.directive';\nimport { PanZoomExcludeDirective } from './pan-zoom-exclude.directive';\n\n\n\n@NgModule({\n  declarations: [PanZoomDirective, PanZoomExcludeDirective],\n  imports: [],\n  exports: [PanZoomDirective, PanZoomExcludeDirective]\n})\nexport class PanZoomDirectiveModule { }\n","/*\n * Public API Surface of pan-zoom-directive\n */\n\nexport * from './lib/pan-zoom.directive';\nexport * from './lib/pan-zoom-exclude.directive';\nexport * from './lib/pan-zoom-directive.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["normalizePassiveListenerOptions","EventEmitter","Directive","ElementRef","Inject","DOCUMENT","Input","Output","HostListener","NgModule"],"mappings":"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"}