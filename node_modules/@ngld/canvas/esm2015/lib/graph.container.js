import { darkenColor } from './utils';
export class GraphContainer {
    constructor(colorGetter) {
        this.colorGetter = colorGetter;
        this.relationships = [];
        this.nodes = [];
        this.rawGraph = {
            nodes: [],
            relationships: [],
        };
    }
    /**
     * addRelation
     */
    addRelation(rel) {
        this.rawGraph.relationships.push(rel);
        this.relationships.push(Object.assign({ translate: { x: 0, y: 0 }, rotate: 0, controlledByDragging: false, isLongPressing: false, selected: false, textTranslate: { x: 0, y: 0 }, pathDrawn: {
                A1: { x: 0, y: 0 }, B1: { x: 0, y: 0 }, C1: { x: 0, y: 0 },
                D1: { x: 0, y: 0 },
                A2: { x: 0, y: 0 }, B2: { x: 0, y: 0 }, C2: { x: 0, y: 0 },
                D2: { x: 0, y: 0 }, E2: { x: 0, y: 0 }, F2: { x: 0, y: 0 },
                G2: { x: 0, y: 0 },
                A3: { x: 0, y: 0 }, B3: { x: 0, y: 0 }, C3: { x: 0, y: 0 },
                D3: { x: 0, y: 0 },
            }, color: { fill: '#68bdf6', stroke: '#4984ac' }, textBoxSize: { width: 1, height: 1 } }, rel));
        return this;
    }
    removeRelationById(id) {
        const temp = [];
        while (true) {
            const rel = this.relationships.shift();
            if (!rel) {
                break;
            }
            if (rel.id === id) {
                break;
            }
            temp.unshift(rel);
        }
        temp.forEach(rel => this.relationships.unshift(rel));
        const tempRawRelationship = [];
        while (true) {
            const rel = this.rawGraph.relationships.shift();
            if (!rel) {
                break;
            }
            if (rel.id === id) {
                break;
            }
            tempRawRelationship.unshift(rel);
        }
        tempRawRelationship.forEach(rel => this.rawGraph.relationships.unshift(rel));
    }
    /**
     * addNode
     */
    addNode(node) {
        this.rawGraph.nodes.push(node);
        const color = this.colorGetter.nextColorByName(node.labels[0]);
        this.nodes.push(Object.assign({ translate: { x: 0, y: 0 }, rotate: 0, controlledByDragging: false, isLongPressing: false, selected: false, textTranslate: { x: 0, y: 0 }, pathDrawn: {
                A1: { x: 0, y: 0 }, B1: { x: 0, y: 0 }, C1: { x: 0, y: 0 },
                D1: { x: 0, y: 0 }, R1: { inner: 33, outer: 33 },
            }, color: { fill: color, stroke: darkenColor(color).formatHex() } }, node));
        return this;
    }
    removeNodeById(id) {
        const temp = [];
        while (true) {
            const node = this.nodes.shift();
            if (!node) {
                break;
            }
            if (node.id === id) {
                break;
            }
            temp.unshift(node);
        }
        temp.forEach(node => this.nodes.unshift(node));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3JhcGguY29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9ncmFwaC5jb250YWluZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQStEdEMsTUFBTSxPQUFPLGNBQWM7SUFjekIsWUFDVSxXQUFpQztRQUFqQyxnQkFBVyxHQUFYLFdBQVcsQ0FBc0I7UUFicEMsa0JBQWEsR0FHZCxFQUFFLENBQUM7UUFFRixVQUFLLEdBQTZDLEVBQUUsQ0FBQztRQUVwRCxhQUFRLEdBQWdCO1lBQzlCLEtBQUssRUFBRSxFQUFFO1lBQ1QsYUFBYSxFQUFFLEVBQUU7U0FDbEIsQ0FBQztJQUlFLENBQUM7SUFFTDs7T0FFRztJQUNJLFdBQVcsQ0FBQyxHQUFtQjtRQUNwQyxJQUFJLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLGlCQUNyQixTQUFTLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFDekIsTUFBTSxFQUFFLENBQUMsRUFBRSxvQkFBb0IsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFDN0QsUUFBUSxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFDOUMsU0FBUyxFQUFFO2dCQUNULEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFDMUQsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUNsQixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQzFELEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTtnQkFDMUQsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO2dCQUNsQixFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQzFELEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRTthQUNuQixFQUNELEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxFQUM3QyxXQUFXLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsSUFDakMsR0FBRyxFQUNOLENBQUM7UUFDSCxPQUFPLElBQUksQ0FBQztJQUNk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Z0JBQ1QsTUFBTTthQUNQO1lBQ0QsSUFBSSxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRTtnQkFDbEIsTUFBTTthQUNQO1lBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNwQjtRQUNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2pELENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNpbXBsZUdyYXBoLCBEM1JlbGF0aW9uc2hpcCwgRDNOb2RlIH0gZnJvbSAnLi9kYXRhLWludGVyZmFjZSc7XG5pbXBvcnQgeyBkYXJrZW5Db2xvciB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgQ29sb3JQcm92aWRlclNlcnZpY2UgfSBmcm9tICcuL2NvbG9yLXByb3ZpZGVyLnNlcnZpY2UnO1xuXG4vKipcbiAqIE5vdCBzdXJlIHdoZXRoZXIgYSBzZXJ2aWNlIHdvdWxkIGJlIGJldHRlciB0byBtYWludGFpbiBhIGdyYXBoaWMgZGF0YSBmb3JcbiAqIHVuZGVybHlpbmcgY29tcG9uZW50XG4gKi9cblxudHlwZSBDT0xPUl9IRVggPSBzdHJpbmc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRDNTVkdDYWxjdWxhdGVkPFBBVEg+IHtcbiAgdHJhbnNsYXRlOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIC8vIGRlZmF1bHQgc3ZnIHJvdGF0aW9uIGlzIGNsb2Nrd2lzZVxuICByb3RhdGU6IG51bWJlcjtcbiAgcGF0aERyYXduOiBQQVRIO1xuICBjb250cm9sbGVkQnlEcmFnZ2luZzogYm9vbGVhbjtcbiAgaXNMb25nUHJlc3Npbmc6IGJvb2xlYW47XG4gIHNlbGVjdGVkOiBib29sZWFuO1xuICB0ZXh0VHJhbnNsYXRlOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG5cbiAgY29sb3I6IHtcbiAgICBmaWxsOiBDT0xPUl9IRVg7XG4gICAgc3Ryb2tlOiBDT0xPUl9IRVg7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXJyb3dQYXRoIHtcbiAgLy8gVGhlIEFycm93IFRhaWwgOiBBIHZlY3RvciBvZiBBIC0+IEIgLT4gQyAtPiBEXG4gIEExOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEIxOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEMxOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEQxOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIC8vIFRoZSBBcnJvdyBIZWFkOiBBIC0+IEIgLT4gQyAtPiBEIC0+IEUgLT4gRiAtPiBHXG4gIEEyOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEIyOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEMyOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEQyOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEUyOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEYyOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEcyOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIC8vIFRoZSBBcnJvdyBPdmVybGF5XG4gIEEzOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEIzOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEMzOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEQzOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2lyY2xlUGF0aCB7XG4gIC8vIFN1YnBhbmVscyBpbiBDbG9ja3dpc2VcbiAgLy8gICAgICAgICBBMSAtLS0gQjFcbiAgLy8gICAgICBEMS0tLS0tLS0tLS0tLUMxXG4gIEExOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEIxOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEMxOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIEQxOiB7IHg6IG51bWJlciwgeTogbnVtYmVyIH07XG4gIFIxOiB7IGlubmVyOiBudW1iZXIsIG91dGVyOiBudW1iZXIgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCb3hTaXplIHtcbiAgd2lkdGg6IG51bWJlcjtcbiAgaGVpZ2h0OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBHcmFwaENvbnRhaW5lciB7XG5cbiAgcHVibGljIHJlbGF0aW9uc2hpcHM6IChcbiAgICBEM1JlbGF0aW9uc2hpcCAmIEQzU1ZHQ2FsY3VsYXRlZDxBcnJvd1BhdGg+XG4gICAgJiB7IHRleHRCb3hTaXplOiBCb3hTaXplIH1cbiAgKVtdID0gW107XG5cbiAgcHVibGljIG5vZGVzOiAoRDNOb2RlICYgRDNTVkdDYWxjdWxhdGVkPENpcmNsZVBhdGg+KVtdID0gW107XG5cbiAgcHJpdmF0ZSByYXdHcmFwaDogU2ltcGxlR3JhcGggPSB7XG4gICAgbm9kZXM6IFtdLFxuICAgIHJlbGF0aW9uc2hpcHM6IFtdLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY29sb3JHZXR0ZXI6IENvbG9yUHJvdmlkZXJTZXJ2aWNlLFxuICApIHsgfVxuXG4gIC8qKlxuICAgKiBhZGRSZWxhdGlvblxuICAgKi9cbiAgcHVibGljIGFkZFJlbGF0aW9uKHJlbDogRDNSZWxhdGlvbnNoaXApOiBHcmFwaENvbnRhaW5lciB7XG4gICAgdGhpcy5yYXdHcmFwaC5yZWxhdGlvbnNoaXBzLnB1c2gocmVsKTtcbiAgICB0aGlzLnJlbGF0aW9uc2hpcHMucHVzaCh7XG4gICAgICB0cmFuc2xhdGU6IHsgeDogMCwgeTogMCB9LFxuICAgICAgcm90YXRlOiAwLCBjb250cm9sbGVkQnlEcmFnZ2luZzogZmFsc2UsIGlzTG9uZ1ByZXNzaW5nOiBmYWxzZSxcbiAgICAgIHNlbGVjdGVkOiBmYWxzZSwgdGV4dFRyYW5zbGF0ZTogeyB4OiAwLCB5OiAwIH0sXG4gICAgICBwYXRoRHJhd246IHtcbiAgICAgICAgQTE6IHsgeDogMCwgeTogMCB9LCBCMTogeyB4OiAwLCB5OiAwIH0sIEMxOiB7IHg6IDAsIHk6IDAgfSxcbiAgICAgICAgRDE6IHsgeDogMCwgeTogMCB9LFxuICAgICAgICBBMjogeyB4OiAwLCB5OiAwIH0sIEIyOiB7IHg6IDAsIHk6IDAgfSwgQzI6IHsgeDogMCwgeTogMCB9LFxuICAgICAgICBEMjogeyB4OiAwLCB5OiAwIH0sIEUyOiB7IHg6IDAsIHk6IDAgfSwgRjI6IHsgeDogMCwgeTogMCB9LFxuICAgICAgICBHMjogeyB4OiAwLCB5OiAwIH0sXG4gICAgICAgIEEzOiB7IHg6IDAsIHk6IDAgfSwgQjM6IHsgeDogMCwgeTogMCB9LCBDMzogeyB4OiAwLCB5OiAwIH0sXG4gICAgICAgIEQzOiB7IHg6IDAsIHk6IDAgfSxcbiAgICAgIH0sXG4gICAgICBjb2xvcjogeyBmaWxsOiAnIzY4YmRmNicsIHN0cm9rZTogJyM0OTg0YWMnIH0sXG4gICAgICB0ZXh0Qm94U2l6ZTogeyB3aWR0aDogMSwgaGVpZ2h0OiAxIH0sXG4gICAgICAuLi5yZWxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVSZWxhdGlvbkJ5SWQoaWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IHRlbXA6IEdyYXBoQ29udGFpbmVyWydyZWxhdGlvbnNoaXBzJ10gPSBbXTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgY29uc3QgcmVsID0gdGhpcy5yZWxhdGlvbnNoaXBzLnNoaWZ0KCk7XG4gICAgICBpZiAoIXJlbCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChyZWwuaWQgPT09IGlkKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgdGVtcC51bnNoaWZ0KHJlbCk7XG4gICAgfVxuICAgIHRlbXAuZm9yRWFjaChyZWwgPT4gdGhpcy5yZWxhdGlvbnNoaXBzLnVuc2hpZnQocmVsKSk7XG4gICAgY29uc3QgdGVtcFJhd1JlbGF0aW9uc2hpcDogRDNSZWxhdGlvbnNoaXBbXSA9IFtdO1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICBjb25zdCByZWwgPSB0aGlzLnJhd0dyYXBoLnJlbGF0aW9uc2hpcHMuc2hpZnQoKTtcbiAgICAgIGlmICghcmVsKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKHJlbC5pZCA9PT0gaWQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICB0ZW1wUmF3UmVsYXRpb25zaGlwLnVuc2hpZnQocmVsKTtcbiAgICB9XG4gICAgdGVtcFJhd1JlbGF0aW9uc2hpcC5mb3JFYWNoKHJlbCA9PiB0aGlzLnJhd0dyYXBoLnJlbGF0aW9uc2hpcHMudW5zaGlmdChyZWwpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBhZGROb2RlXG4gICAqL1xuICBwdWJsaWMgYWRkTm9kZShub2RlOiBEM05vZGUpOiBHcmFwaENvbnRhaW5lciB7XG4gICAgdGhpcy5yYXdHcmFwaC5ub2Rlcy5wdXNoKG5vZGUpO1xuICAgIGNvbnN0IGNvbG9yID0gdGhpcy5jb2xvckdldHRlci5uZXh0Q29sb3JCeU5hbWUobm9kZS5sYWJlbHNbMF0pO1xuICAgIHRoaXMubm9kZXMucHVzaCh7XG4gICAgICB0cmFuc2xhdGU6IHsgeDogMCwgeTogMCB9LFxuICAgICAgcm90YXRlOiAwLCBjb250cm9sbGVkQnlEcmFnZ2luZzogZmFsc2UsIGlzTG9uZ1ByZXNzaW5nOiBmYWxzZSxcbiAgICAgIHNlbGVjdGVkOiBmYWxzZSwgdGV4dFRyYW5zbGF0ZTogeyB4OiAwLCB5OiAwIH0sXG4gICAgICBwYXRoRHJhd246IHtcbiAgICAgICAgQTE6IHsgeDogMCwgeTogMCB9LCBCMTogeyB4OiAwLCB5OiAwIH0sIEMxOiB7IHg6IDAsIHk6IDAgfSxcbiAgICAgICAgRDE6IHsgeDogMCwgeTogMCB9LCBSMTogeyBpbm5lcjogMzMsIG91dGVyOiAzMyB9LFxuICAgICAgfSxcbiAgICAgIGNvbG9yOiB7IGZpbGw6IGNvbG9yLCBzdHJva2U6IGRhcmtlbkNvbG9yKGNvbG9yKS5mb3JtYXRIZXgoKSB9LFxuICAgICAgLi4ubm9kZSxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVOb2RlQnlJZChpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgdGVtcDogR3JhcGhDb250YWluZXJbJ25vZGVzJ10gPSBbXTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgY29uc3Qgbm9kZSA9IHRoaXMubm9kZXMuc2hpZnQoKTtcbiAgICAgIGlmICghbm9kZSkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChub2RlLmlkID09PSBpZCkge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIHRlbXAudW5zaGlmdChub2RlKTtcbiAgICB9XG4gICAgdGVtcC5mb3JFYWNoKG5vZGUgPT4gdGhpcy5ub2Rlcy51bnNoaWZ0KG5vZGUpKTtcbiAgfVxufVxuIl19